<!-- 目標値登録 -->
<apex:page controller="GEA01001Controller" docType="html-5.0" id="page" standardStylesheets="false" title="目標値登録">
    
    <head>
        <meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <meta name="format-detection" content="telephone=no"/>
        <meta name="robots" content="noindex" />
        <title>目標値登録</title>
    </head>
    
    <apex:includeScript value="{!URLFOR($Resource.jQuery, 'jQuery/jquery-3.6.0.min.js')}"/>
    <apex:includeScript value="{!URLFOR($Resource.jQuery, 'jQuery/jquery.blockUI.js')}"/>
    <apex:stylesheet value="{!URLFOR($Resource.designer_file,'designer_file/css/reset.min.css')}"/>
    <apex:stylesheet value="{!URLFOR($Resource.designer_file,'designer_file/css/foundation.css')}"/>
    <apex:stylesheet value="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"/>    
    <apex:stylesheet value="{!URLFOR($Resource.designer_file,'designer_file/css/modaal.css')}"/>
    <apex:stylesheet value="{!URLFOR($Resource.designer_file,'designer_file/css/style.css')}"/>
    <apex:includeScript value="{!URLFOR($Resource.designer_file,'designer_file/js/modaal.js')}"/> 
    <apex:includeScript value="{!URLFOR($Resource.external_file,'external_file/common_screen_util.js')}" />
    <apex:includeScript value="{!URLFOR($Resource.external_file, 'external_file/input_rules.js')}"/>
    <apex:stylesheet value="{!URLFOR($Resource.external_file, 'external_file/common_style.css')}"/>  
    
    <apex:includeScript value="{!URLFOR($Resource.jQuery, 'jQuery/jQueryUI/jquery-ui.min.js')}" />
    <apex:stylesheet value="{!URLFOR($Resource.jQuery,'jQuery/jQueryUI/jquery-ui.css')}" /> 
    
    
    <apex:outputPanel id="jsMessage">
        <script language="javascript" type="text/javascript">
        //全社目標保存確認メッセージ
        async function checkSaveCompanyGoal(){
            var message = "{! MSG_COM_V_SAVE}";
            var retVal = await showConfirm(message);
            if (retVal) {
                blockUi();
                saveCompanyGoal();
            }          
        }
        //店舗目標反響保存確認メッセージ
        async function checkSaveEchoShopGoal(){
            var message = "{! MSG_COM_V_SAVE}";
            var retVal = await showConfirm(message);
            if (retVal) {
                blockUi();
                saveEchoShopGoal();
            }          
        }
        //店舗目標物確保存確認メッセージ
        async function checkSavePropertyConfirmationShopGoal(){
            var message = "{! MSG_COM_V_SAVE}";
            var retVal = await showConfirm(message);
            if (retVal) {
                blockUi();
                savePropertyConfirmationShopGoal();
            }          
        }
        
        // 登録完了メッセージ
        async function alertSaveFinish(){
            unblockUi();
            //完了メッセージ
            await showAlert("{! MSG_COM_I_SAVE}");
        } 
        
        //再計算確認メッセージ
        async function checkCalc() {
            var message = "{! MSG_REPORT_V_EXECUTE_CALC}";
            var retVal = await showConfirm(message);
            if (retVal) {
                blockUi();
                calculateShopGoalEchoCount();
            }          
        }
        </script>
    </apex:outputPanel>
    
    <body id="gea01001">
        <main>
            <apex:pageMessages id="message"/>
            <article>
                <section class="">

                    <section>
                        <apex:form >
                            <section style="display: flex">
                                <h1 class="fontb font2rem">目標値登録</h1>
                                <apex:commandButton style=" visibility:hidden;" rerender="dummy"/> 
                            </section>
                            <!-- actionFunction -->
                            <apex:actionFunction action="{! calcCompanyGoalRateSum}"   name="calcCompanyGoalRateSum"
                                                 rerender="companyGoalRateSum, js" />
                            
                            <apex:actionFunction action="{! saveCompanyGoal}"   name="saveCompanyGoal"
                                                 oncomplete="unblockUi();if(!{! hasErrorMessage}){alertSaveFinish()  }else{gotoTop()}" 
                                                 rerender="echoShopGoalbtn, propertyConfirmationShopGoalbtn, message, js" />
                            
                            <apex:actionFunction action="{! saveEchoShopGoal}"   name="saveEchoShopGoal"
                                                 oncomplete="unblockUi();if(!{! hasErrorMessage}){alertSaveFinish()  }else{gotoTop()}" 
                                                 rerender="message, js" />
                            
                            <apex:actionFunction action="{! savePropertyConfirmationShopGoal}"   name="savePropertyConfirmationShopGoal"
                                                 oncomplete="unblockUi();if(!{! hasErrorMessage}){alertSaveFinish()  }else{gotoTop()}" 
                                                 rerender="message, js" />
                            
                            <apex:actionFunction action="{! calculateShopGoalRateSum}"   name="calculateShopGoalRateSum"
                                                 rerender="companyGoalEchoCount, PropertyConfirmationCountGoal, echoCountTotal, echoCountTotalSum, displayISSum, js" />
                            
                            <apex:actionFunction action="{! calculateShopGoalSales}"   name="calculateShopGoalSales"
                                                 rerender="salesGoal, displayISSum, js" />
                            
                            <apex:actionFunction action="{! calculateShopGoalEchoCount}"   name="calculateShopGoalEchoCount"
                                                 oncomplete="unblockUi();" 
                                                 rerender="companyGoalEchoCount, propertyConfirmationShopGoal, echoShopGoal,  js" />
                            
                            <div class="border-g ">
                                <div class="pdr30 pdl30  pdr10_xs pdl10_xs">
                                    <apex:outputPanel id="targetYear">
                                    <apex:commandButton style="display:none;" rerender="dummy" />
                                    <div class="mt30">対象年</div>
                                    <!-- Enterキーのダミー -->
                                    <div class="flex-wrap flex_wrap align-items_end">
                                        <div class="mr5">
                                            <apex:input type="text" styleClass="form-control" value="{!targetYear}" 
                                            onchange="correctInputRules(this,'number','4','','4000',false,'1700')" tabIndex="1"/>
                                        </div>
                                        <apex:commandButton value="作成または表示" styleClass="btn btn-info  text-center  mr5" 
                                                            onclick="blockUi();"
                                                            action="{!setDisplay}" 
                                                            rerender="companyGoal, echoShopGoal, propertyConfirmationShopGoal, message, js, targetYear" 
                                                            oncomplete="unblockUi();if({! hasErrorMessage}){gotoTop()}"
                                                            disabled="{!isOpenError}" tabIndex="2"
                                                            />
                                        <div class="fsmall font_gray">※対象年に存在する場合は表示します。なければ作成します。</div>
                                    </div>
                                    </apex:outputPanel>
                                    <ul id="accordion" class="accordion-defalt">
                                        <apex:outputPanel id="companyGoal">
                                            <apex:outputPanel rendered="{!isCompanyGoalView}">
                                        <li class="default open">
                                                    <div class="link posi_re"><i class="fa fa-chevron-up"></i>全社目標
                                                        <div class="ab_btn">
                                                            <div class="flex-wrap">
                                                                <apex:commandButton value="　更新　" styleClass="text-center blue btn-w-2"
                                                                                    onclick="checkSaveCompanyGoal();"   rerender="dummy"
                                                                                    disabled="{!isOpenError}" tabIndex="17"
                                                                                    />
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <ul class="submenu-defalt">
                                                        <li>
                                                            <div class="flex-wrap  flex_wrap justify-between">
                                                                <div class=" mb10 wd33  wd100_xs">
                                                                    <div class="information_title">反響数</div>
                                                                    <div class="information_contents">
                                                                        <apex:outputPanel id="companyGoalEchoCount">
                                                                        <apex:outputLabel id="echoCount" value="{!displayCompanyGoal.echoCount}"/>
                                                                        </apex:outputPanel>
                                                                    </div>
                                                                </div>
                                                                <div class=" mb10 wd33  wd100_xs">
                                                                    <div class="information_title">ISの呼込率(%)</div>
                                                                    <apex:input type="text" styleClass="form-control" value="{!displayCompanyGoal.callRate}" 
                                                                    onchange="correctInputRules(this,'number','3','','100','','1')" tabIndex="3"/>
                                                                    
                                                                </div>
                                                                <div class=" mb10 wd33   wd100_xs">
                                                                    <div class="information_title">全体の申込率(%)</div>
                                                                    <apex:input type="text" styleClass="form-control" value="{!displayCompanyGoal.applicantRate}" 
                                                                    onchange="correctInputRules(this,'number','3','','100','','1')" tabIndex="4"/>
                                                                </div>
                                                            </div>
                                                            <div class="mb10">月別反響目標割合<span class="fsmall font_gray">※店舗目標の月別反響数を設定した値を按分いたします。 ※月別反響目標割合の合計が、100％になるよう入力をお願いいたします。</span></div>
                                                            <div class="flex-wrap align_center mb10">
                                                                <div class="mr5">合計</div>
                                                                <div class="information_contents_no_margin flex-wrap justify-between align_center">
                                                                    <apex:outputLabel id="companyGoalRateSum" value="{!companyGoalRateSum}" styleClass="wd1 text-right" /><div>%</div>
                                                                </div>
                                                            </div>
                                                            <div class="flex-wrap  flex_wrap justify-between">
                                                                <div class=" mb10 wd16  wd100_xs">
                                                                    <div class="information_title">{!displayMonths[0]}月</div>
                                                                    <div class="flex-wrap justify-between align_center">
                                                                        <apex:input type="text" styleClass="form-control mr5" value="{!displayCompanyGoal.rates[0]}" 
                                                                        onchange="correctInputRules(this,'number','3','','100','','0'); calcCompanyGoalRateSum();" tabIndex="5"/><div>%</div>
                                                                    </div>
                                                                </div>
                                                                <div class=" mb10 wd16  wd100_xs">
                                                                    <div class="information_title">{!displayMonths[1]}月</div>
                                                                    <div class="flex-wrap justify-between align_center">
                                                                        <apex:input type="text" styleClass="form-control mr5" value="{!displayCompanyGoal.rates[1]}" 
                                                                        onchange="correctInputRules(this,'number','3','','100','','0'); calcCompanyGoalRateSum();" tabIndex="6"/><div>%</div>
                                                                    </div>
                                                                </div>
                                                                <div class=" mb10 wd16  wd100_xs">
                                                                    <div class="information_title">{!displayMonths[2]}月</div>
                                                                    <div class="flex-wrap justify-between align_center">
                                                                        <apex:input type="text" styleClass="form-control mr5" value="{!displayCompanyGoal.rates[2]}" 
                                                                        onchange="correctInputRules(this,'number','3','','100','','0'); calcCompanyGoalRateSum();" tabIndex="7"/><div>%</div>
                                                                    </div>
                                                                </div>
                                                                <div class=" mb10 wd16  wd100_xs">
                                                                    <div class="information_title">{!displayMonths[3]}月</div>
                                                                    <div class="flex-wrap justify-between align_center">
                                                                        <apex:input type="text" styleClass="form-control mr5" value="{!displayCompanyGoal.rates[3]}" 
                                                                        onchange="correctInputRules(this,'number','3','','100','','0'); calcCompanyGoalRateSum();" tabIndex="8"/><div>%</div>
                                                                    </div>
                                                                </div>
                                                                <div class=" mb10 wd16  wd100_xs">
                                                                    <div class="information_title">{!displayMonths[4]}月</div>
                                                                    <div class="flex-wrap justify-between align_center">
                                                                        <apex:input type="text" styleClass="form-control mr5" value="{!displayCompanyGoal.rates[4]}" 
                                                                        onchange="correctInputRules(this,'number','3','','100','','0'); calcCompanyGoalRateSum();" tabIndex="9"/><div>%</div>
                                                                    </div>
                                                                </div>
                                                                <div class=" mb10 wd16  wd100_xs">
                                                                    <div class="information_title">{!displayMonths[5]}月</div>
                                                                    <div class="flex-wrap justify-between align_center">
                                                                        <apex:input type="text" styleClass="form-control mr5" value="{!displayCompanyGoal.rates[5]}" 
                                                                        onchange="correctInputRules(this,'number','3','','100','','0'); calcCompanyGoalRateSum();" tabIndex="10"/><div>%</div>
                                                                    </div>
                                                                </div>
                                                                <div class=" mb10 wd16  wd100_xs">
                                                                    <div class="information_title">{!displayMonths[6]}月</div>
                                                                    <div class="flex-wrap justify-between align_center">
                                                                        <apex:input type="text" styleClass="form-control mr5" value="{!displayCompanyGoal.rates[6]}" 
                                                                        onchange="correctInputRules(this,'number','3','','100','','0'); calcCompanyGoalRateSum();" tabIndex="11"/><div>%</div>
                                                                    </div>
                                                                </div>
                                                                <div class=" mb10 wd16  wd100_xs">
                                                                    <div class="information_title">{!displayMonths[7]}月</div>
                                                                    <div class="flex-wrap justify-between align_center">
                                                                        <apex:input type="text" styleClass="form-control mr5" value="{!displayCompanyGoal.rates[7]}" 
                                                                        onchange="correctInputRules(this,'number','3','','100','','0'); calcCompanyGoalRateSum();" tabIndex="12"/><div>%</div>
                                                                    </div>
                                                                </div>
                                                                <div class=" mb10 wd16  wd100_xs">
                                                                    <div class="information_title">{!displayMonths[8]}月</div>
                                                                    <div class="flex-wrap justify-between align_center">
                                                                        <apex:input type="text" styleClass="form-control mr5" value="{!displayCompanyGoal.rates[8]}" 
                                                                        onchange="correctInputRules(this,'number','3','','100','','0'); calcCompanyGoalRateSum();" tabIndex="13"/><div>%</div>
                                                                    </div>
                                                                </div>
                                                                <div class=" mb10 wd16  wd100_xs">
                                                                    <div class="information_title">{!displayMonths[9]}月</div>
                                                                    <div class="flex-wrap justify-between align_center">
                                                                        <apex:input type="text" styleClass="form-control mr5" value="{!displayCompanyGoal.rates[9]}" 
                                                                        onchange="correctInputRules(this,'number','3','','100','','0'); calcCompanyGoalRateSum();" tabIndex="14"/><div>%</div>
                                                                    </div>
                                                                </div>
                                                                <div class=" mb10 wd16  wd100_xs">
                                                                    <div class="information_title">{!displayMonths[10]}月</div>
                                                                    <div class="flex-wrap justify-between align_center">
                                                                        <apex:input type="text" styleClass="form-control mr5" value="{!displayCompanyGoal.rates[10]}" 
                                                                        onchange="correctInputRules(this,'number','3','','100','','0'); calcCompanyGoalRateSum();" tabIndex="15"/><div>%</div>
                                                                    </div>
                                                                </div>
                                                                <div class=" mb10 wd16  wd100_xs">
                                                                    <div class="information_title">{!displayMonths[11]}月</div>
                                                                    <div class="flex-wrap justify-between align_center">
                                                                        <apex:input type="text" styleClass="form-control mr5" value="{!displayCompanyGoal.rates[11]}" 
                                                                        onchange="correctInputRules(this,'number','3','','100','','0'); calcCompanyGoalRateSum();" tabIndex="16"/><div>%</div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </li>
                                                    </ul>
                                        </li>
                                        </apex:outputPanel>
                                        </apex:outputPanel>
                                        <apex:outputPanel id="echoShopGoal">
                                            <apex:outputPanel rendered="{!isShopGoalEchoView && isCompanyGoalView}">
                                        <li class="default open">
                                                    <div class="link posi_re"><i class="fa fa-chevron-up"></i>店舗目標(反響)
                                                        <div class="ab_btn ab_btn_xs" style="top :5px">
                                                            <apex:outputPanel id="echoShopGoalbtn">
                                                            <div class="flex-wrap">
                                                                <apex:commandButton value="反響/物確切替" styleClass=" btn-w-2 btn-w-2-r blue"
                                                                                    onclick="blockUi();" action="{!changeDisplayShopGoal}"  
                                                                                    rerender="propertyConfirmationShopGoal, echoShopGoal, message, js"
                                                                                    oncomplete="unblockUi();if({! hasErrorMessage}){gotoTop()}"
                                                                                    disabled="{!isOpenError}" tabIndex="18"
                                                                                    />
                                                                <apex:commandButton value="　月別再計算　" styleClass=" btn-w-2 blue"
                                                                                    onclick="checkCalc();"   rerender="dummy"
                                                                                    disabled="{!isOpenError || displayCompanyGoal.Id = null}" tabIndex="19"
                                                                                    />
                                                                <apex:commandButton value="　更新　" styleClass="  btn-w-2 btn-w-2-l blue"
                                                                                    onclick="checkSaveEchoShopGoal();"   rerender="dummy"
                                                                                    disabled="{!isOpenError || displayCompanyGoal.Id = null}" tabIndex="20"
                                                                                    />
                                                            </div>
                                                            </apex:outputPanel>
                                                        </div>
                                                    </div>
                                                    
                                                    <ul class="submenu-defalt">
                                                        <li>
                                                            <form name="stationform">
                                                                <!-- 外枠 -->
                                                                <div class="x_data_area ">
                                                                    <!-- ロック部分 -->
                                                                    <div class="lock_box" style="width: 40%;">
                                                                        <table id="shopTableHeader" class="width300 data gray scrollableHidden" style="height:404px;"
                                                                                onscroll="linkScrollY(this, 'shopTable');">
                                                                            <tr class="height35">
                                                                                <th class="wd0 r_none b_none border_top b_none">
                                                                                    <apex:inputCheckbox id="sc" styleClass="shopHeadCheck" value="{!isShopAllChecked}" 
                                                                                                        onClick="listCheckBoxAllChange(this, '.shopHeadCheck',  '.shopCheck');"/>
                                                                                    <apex:outputLabel for="sc" styleClass="serach_check3" /> 
                                                                                </th>
                                                                                <th class="wd5 r_none b_none border_top">店舗</th>
                                                                                <th class="wd3 r_none b_none border_top">反響数（合計）</th>
                                                                                <th class="wd3 r_none b_none border_top">売上目標</th>
                                                                                
                                                                            </tr>
                                                                            <apex:repeat value="{!displayShopGoalList}" var="shop">
                                                                                <tr class="height35">
                                                                                    <td class="wd0 r_none b_none  b_none" style="padding: 5px 4px;">
                                                                                        <!-- チェックボックスのstyleはヘッダーのチェックボックスに合わせる -->
                                                                                        <apex:inputCheckbox id="sc" styleClass="shopCheck" value="{!shop.isCheckbox}" 
                                                                                                            onchange="headCheckBoxChange(this, '.shopHeadCheck',  '.shopCheck');"/>
                                                                                        <apex:outputLabel for="sc" styleClass="serach_check3" /> 
                                                                                    </td>
                                                                                    <td class="r_none b_none"><apex:outputLabel id="name" value="{!shop.name}"/></td>
                                                                                    <td class="r_none b_none"><apex:outputLabel id="echoCountTotal" value="{!shop.echoCountTotal}"/></td>
                                                                                    <td class="r_none b_none"><apex:outputLabel id="salesGoal" value="{!shop.salesGoal}"/></td>
                                                                                </tr>
                                                                            </apex:repeat>
                                                                        </table>
                                                                    </div>
                                                                    <!-- ロック部分 -->
                                                                    <!-- 横スクロール部分 -->
                                                                    <div class="x_scroll_box" style="width: 60%; overflow-x: hidden;">
                                                                        <table id="shopTable" class="width2500 data gray" style="height:423px;"
                                                                                onscroll="linkScrollY(this, 'shopTableHeader');">
                                                                            <tr class="height35">
                                                                                <th class="wd5 b_none ">平均単価</th>
                                                                                <th class="wd5 b_none">反響数</th>
                                                                                <th class="wd3 b_none">{!displayMonths[0]}月</th>
                                                                                <th class="wd3 b_none">{!displayMonths[1]}月</th>
                                                                                <th class="wd3 b_none">{!displayMonths[2]}月</th>
                                                                                <th class="wd3 b_none">{!displayMonths[3]}月</th>
                                                                                <th class="wd3 b_none">{!displayMonths[4]}月</th>
                                                                                <th class="wd3 b_none">{!displayMonths[5]}月</th>
                                                                                <th class="wd3 b_none">{!displayMonths[6]}月</th>
                                                                                <th class="wd3 b_none">{!displayMonths[7]}月</th>
                                                                                <th class="wd3 b_none">{!displayMonths[8]}月</th>
                                                                                <th class="wd3 b_none">{!displayMonths[9]}月</th>
                                                                                <th class="wd3 b_none">{!displayMonths[10]}月</th>
                                                                                <th class="wd3 r_none b_none">{!displayMonths[11]}月</th>
                                                                            </tr>
                                                                            <apex:repeat value="{!displayShopGoalList}" var="shop">
                                                                                <tr class="height35">
                                                                                    <td class=" b_none l_none"><apex:input type="text" styleClass="wd75px" value="{!shop.averageUnitPrice}" 
                                                                                        onchange="correctInputRules(this,'number','7','','','','1'); calculateShopGoalSales();" tabIndex=""/></td>
                                                                                    <td class=" b_none l_none"><apex:input type="text" styleClass="wd75px" value="{!shop.echoCountGoal}" 
                                                                                        onchange="correctInputRules(this,'number','8','','','','1'); calculateShopGoalSales();" tabIndex=""/></td>
                                                                                    <td class=" b_none l_none"><apex:input type="text" styleClass="wd75px" value="{!shop.echoCounts[0]}" 
                                                                                        onchange="correctInputRules(this,'number','6','','','','0');calculateShopGoalRateSum();" tabIndex=""/></td>
                                                                                    <td class=" b_none l_none"><apex:input type="text" styleClass="wd75px" value="{!shop.echoCounts[1]}" 
                                                                                        onchange="correctInputRules(this,'number','6','','','','0'); calculateShopGoalRateSum();" tabIndex=""/></td>
                                                                                    <td class=" b_none l_none"><apex:input type="text" styleClass="wd75px" value="{!shop.echoCounts[2]}" 
                                                                                        onchange="correctInputRules(this,'number','6','','','','0'); calculateShopGoalRateSum();" tabIndex=""/></td>
                                                                                    <td class=" b_none l_none"><apex:input type="text" styleClass="wd75px" value="{!shop.echoCounts[3]}" 
                                                                                        onchange="correctInputRules(this,'number','6','','','','0'); calculateShopGoalRateSum();" tabIndex=""/></td>
                                                                                    <td class=" b_none l_none"><apex:input type="text" styleClass="wd75px" value="{!shop.echoCounts[4]}" 
                                                                                        onchange="correctInputRules(this,'number','6','','','','0'); calculateShopGoalRateSum();" tabIndex=""/></td>
                                                                                    <td class=" b_none l_none"><apex:input type="text" styleClass="wd75px" value="{!shop.echoCounts[5]}" 
                                                                                        onchange="correctInputRules(this,'number','6','','','','0'); calculateShopGoalRateSum();" tabIndex=""/></td>
                                                                                    <td class=" b_none l_none"><apex:input type="text" styleClass="wd75px" value="{!shop.echoCounts[6]}" 
                                                                                        onchange="correctInputRules(this,'number','6','','','','0'); calculateShopGoalRateSum();" tabIndex=""/></td>
                                                                                    <td class=" b_none l_none"><apex:input type="text" styleClass="wd75px" value="{!shop.echoCounts[7]}" 
                                                                                        onchange="correctInputRules(this,'number','6','','','','0'); calculateShopGoalRateSum();" tabIndex=""/></td>
                                                                                    <td class=" b_none l_none"><apex:input type="text" styleClass="wd75px" value="{!shop.echoCounts[8]}" 
                                                                                        onchange="correctInputRules(this,'number','6','','','','0'); calculateShopGoalRateSum();" tabIndex=""/></td>
                                                                                    <td class=" b_none l_none"><apex:input type="text" styleClass="wd75px" value="{!shop.echoCounts[9]}" 
                                                                                        onchange="correctInputRules(this,'number','6','','','','0'); calculateShopGoalRateSum();" tabIndex=""/></td>
                                                                                    <td class=" b_none l_none"><apex:input type="text" styleClass="wd75px" value="{!shop.echoCounts[10]}" 
                                                                                        onchange="correctInputRules(this,'number','6','','','','0'); calculateShopGoalRateSum();" tabIndex=""/></td>
                                                                                    <td class=" b_none l_none"><apex:input type="text" styleClass="wd75px" value="{!shop.echoCounts[11]}" 
                                                                                        onchange="correctInputRules(this,'number','6','','','','0'); calculateShopGoalRateSum();" tabIndex=""/></td>
                                                                                </tr>
                                                                            </apex:repeat>
                                                                        </table>
                                                                    </div>
                                                                    <!-- /横スクロール部分 -->
                                                                </div>
                                                                
                                                            </form>
                                                        </li>
                                                        <!-- IS表 -->
                                                        <li>
                                                            <form name="stationform">
                                                                <!-- 外枠 -->
                                                                <div class="x_data_area ">
                                                                    <!-- ロック部分 -->
                                                                    <div class="lock_box" style="width: 40%;">
                                                                        <table id="isTableHeader" class="width300 data gray scrollableHidden" style="height:101px;"
                                                                                onscroll="linkScrollY(this, 'isTable');">
                                                                            <tr>
                                                                                <th class="wd0 r_none b_none border_top b_none"></th>
                                                                                <th class="wd5 r_none b_none border_top">店舗</th>
                                                                                <th class="wd3 r_none b_none border_top">反響数(合計)</th>
                                                                                <th class="wd3 r_none b_none border_top"></th>
                                                                                
                                                                            </tr>
                                                                            <tr>
                                                                                <td class="wd0 r_none b_none  b_none" style="padding: 5px 4px;"></td>
                                                                                <td class="r_none b_none"><apex:outputLabel id="name" value="{!displayIS.name}"/></td>
                                                                                <td class="r_none b_none"><apex:outputLabel id="echoCountTotalSum" value="{!displayIS.echoCountTotalSum}"/></td>
                                                                            </tr>
                                                                        </table>
                                                                    </div>
                                                                    <!-- ロック部分 -->
                                                                    <!-- 横スクロール部分 -->
                                                                    <div class="x_scroll_box" style="width: 60%; overflow-x: hidden;">
                                                                        <apex:outputPanel id="displayISSum">
                                                                        <table id="isTable" class="width2500 data gray" style="height:120px;"
                                                                                onscroll="linkScrollY(this, 'isTableHeader');">
                                                                            <tr>
                                                                                <th class="wd5 b_none ">反響数</th>
                                                                                <th class="wd5 b_none">呼込数</th>
                                                                                <th class="wd3 b_none">{!displayMonths[0]}月</th>
                                                                                <th class="wd3 b_none">{!displayMonths[1]}月</th>
                                                                                <th class="wd3 b_none">{!displayMonths[2]}月</th>
                                                                                <th class="wd3 b_none">{!displayMonths[3]}月</th>
                                                                                <th class="wd3 b_none">{!displayMonths[4]}月</th>
                                                                                <th class="wd3 b_none">{!displayMonths[5]}月</th>
                                                                                <th class="wd3 b_none">{!displayMonths[6]}月</th>
                                                                                <th class="wd3 b_none">{!displayMonths[7]}月</th>
                                                                                <th class="wd3 b_none">{!displayMonths[8]}月</th>
                                                                                <th class="wd3 b_none">{!displayMonths[9]}月</th>
                                                                                <th class="wd3 b_none">{!displayMonths[10]}月</th>
                                                                                <th class="wd3 r_none b_none">{!displayMonths[11]}月</th>
                                                                            </tr>
                                                                            <tr>
                                                                                <td class=" b_none l_none　wd75px"><apex:outputLabel id="echoCountGoalSum" value="{!displayIS.echoCountGoalSum}"/></td>
                                                                                <td class="r_none b_none wd75px"><apex:outputLabel id="echoCountCallRate" value="{!displayIS.echoCountCallRate}"/></td>
                                                                                <td class="r_none b_none wd75px"><apex:outputLabel id="echoCountJulSum" value="{!displayIS.echoCountSums[0]}"/></td>
                                                                                <td class="r_none b_none wd75px"><apex:outputLabel id="echoCountAugSum" value="{!displayIS.echoCountSums[1]}"/></td>
                                                                                <td class="r_none b_none wd75px"><apex:outputLabel id="echoCountSepSum" value="{!displayIS.echoCountSums[2]}"/></td>
                                                                                <td class="r_none b_none wd75px"><apex:outputLabel id="echoCountOctSum" value="{!displayIS.echoCountSums[3]}"/></td>
                                                                                <td class="r_none b_none wd75px"><apex:outputLabel id="echoCountNovSum" value="{!displayIS.echoCountSums[4]}"/></td>
                                                                                <td class="r_none b_none wd75px"><apex:outputLabel id="echoCountDecSum" value="{!displayIS.echoCountSums[5]}"/></td>
                                                                                <td class="r_none b_none wd75px"><apex:outputLabel id="echoCountJanSum" value="{!displayIS.echoCountSums[6]}"/></td>
                                                                                <td class="r_none b_none wd75px"><apex:outputLabel id="echoCountFebSum" value="{!displayIS.echoCountSums[7]}"/></td>
                                                                                <td class="r_none b_none wd75px"><apex:outputLabel id="echoCountMarSum" value="{!displayIS.echoCountSums[8]}"/></td>
                                                                                <td class="r_none b_none wd75px"><apex:outputLabel id="echoCountAprSum" value="{!displayIS.echoCountSums[9]}"/></td>
                                                                                <td class="r_none b_none wd75px"><apex:outputLabel id="echoCountMaySum" value="{!displayIS.echoCountSums[10]}"/></td>
                                                                                <td class="r_none b_none wd75px"><apex:outputLabel id="echoCountJunSum" value="{!displayIS.echoCountSums[11]}"/></td>
                                                                            </tr>
                                                                        </table>
                                                                        </apex:outputPanel>
                                                                    </div>
                                                                    <!-- /横スクロール部分 -->
                                                                </div>
                                                                
                                                            </form>
                                                        </li>
                                                    </ul>
                                        </li>
                                    </apex:outputPanel>
                                    </apex:outputPanel>
                                    <apex:outputPanel id="propertyConfirmationShopGoal">
                                    <apex:outputPanel rendered="{! !isShopGoalEchoView && isCompanyGoalView}">
                                        <li class="default open">
                                                    <div class="link posi_re"><i class="fa fa-chevron-up"></i>店舗目標(物確)
                                                        <div class="ab_btn ab_btn_xs" style="top :5px">
                                                            <apex:outputPanel id="propertyConfirmationShopGoalbtn">
                                                            <div class="flex-wrap">
                                                                <apex:commandButton value="反響/物確切替" styleClass=" btn-w-2 btn-w-2-r blue"
                                                                                    onclick="blockUi();" action="{!changeDisplayShopGoal}"
                                                                                    rerender="propertyConfirmationShopGoal, echoShopGoal, message, js"  
                                                                                    oncomplete="unblockUi();if({! hasErrorMessage}){gotoTop()}"
                                                                                    disabled="{!isOpenError}" tabIndex="21"
                                                                                    />
                                                                <apex:commandButton value="　更新　" styleClass="  btn-w-2 btn-w-2-l blue"
                                                                                    onclick="checkSavePropertyConfirmationShopGoal();"   rerender="dummy"
                                                                                    disabled="{!isOpenError || displayCompanyGoal.Id = null}" tabIndex="22"
                                                                                    />
                                                            </div>
                                                            </apex:outputPanel>
                                                        </div>
                                                    </div>
                                                    <ul class="submenu-defalt">
                                                        <li>
                                                            <form name="stationform">
                                                                <!-- 外枠 -->
                                                                <div class="x_data_area ">
                                                                    <!-- ロック部分 -->
                                                                    <div class="lock_box">
                                                                        <table id="shopTableHeader2" class="width300 data gray scrollableHidden" style="height:404px;"
                                                                                onscroll="linkScrollY(this, 'shopTable2');">
                                                                            
                                                                            <tr>
                                                                                <th class=" r_none b_none border_top height35">店舗</th>
                                                                                <th class=" r_none b_none border_top height35">物確数(年間)</th>
                                                                                
                                                                            </tr>
                                                                            
                                                                            <apex:repeat value="{!displayShopGoalList}" var="shop">
                                                                                <tr>
                                                                                    <td class="r_none b_none"><apex:outputLabel id="name" value="{!shop.name}"/></td>
                                                                                    
                                                                                    <td class="r_none b_none"><apex:outputLabel id="PropertyConfirmationCountGoal" value="{!shop.propertyConfirmationCountGoal}"/></td>
                                                                                </tr>
                                                                            </apex:repeat>
                                                                        </table>
                                                                    </div>
                                                                    <!-- /ロック部分 -->
                                                                    <!-- 横スクロール部分 -->
                                                                    <div class="x_scroll_box" style="overflow-x: hidden;">
                                                                        <table id="shopTable2" class="width2500 data gray" style="height:423px;"
                                                                                onscroll="linkScrollY(this, 'shopTableHeader2');">
                                                                            <tr>
                                                                                <th class="wd3 l_none b_none height35">{!displayMonths[0]}月</th>
                                                                                <th class="wd3 b_none">{!displayMonths[1]}月</th>
                                                                                <th class="wd3 b_none">{!displayMonths[2]}月</th>
                                                                                <th class="wd3 b_none">{!displayMonths[3]}月</th>
                                                                                <th class="wd3 b_none">{!displayMonths[4]}月</th>
                                                                                <th class="wd3 b_none">{!displayMonths[5]}月</th>
                                                                                <th class="wd3 b_none">{!displayMonths[6]}月</th>
                                                                                <th class="wd3 b_none">{!displayMonths[7]}月</th>
                                                                                <th class="wd3 b_none">{!displayMonths[8]}月</th>
                                                                                <th class="wd3 b_none">{!displayMonths[9]}月</th>
                                                                                <th class="wd3 b_none">{!displayMonths[10]}月</th>
                                                                                <th class="wd3 b_none">{!displayMonths[11]}月</th>
                                                                            </tr>
                                                                            <apex:repeat value="{!displayShopGoalList}" var="shop">
                                                                                <tr>
                                                                                    <td class=" b_none l_none"><apex:input type="text" styleClass="wd75px" value="{!shop.propertyConfirmationCounts[0]}" 
                                                                                        onchange="correctInputRules(this,'number','6','','','','0'); calculateShopGoalRateSum();" tabIndex=""/></td>
                                                                                    <td class=" b_none l_none"><apex:input type="text" styleClass="wd75px" value="{!shop.propertyConfirmationCounts[1]}" 
                                                                                        onchange="correctInputRules(this,'number','6','','','','0'); calculateShopGoalRateSum();" tabIndex=""/></td>
                                                                                    <td class=" b_none l_none"><apex:input type="text" styleClass="wd75px" value="{!shop.propertyConfirmationCounts[2]}" 
                                                                                        onchange="correctInputRules(this,'number','6','','','','0'); calculateShopGoalRateSum();" tabIndex=""/></td>
                                                                                    <td class=" b_none l_none"><apex:input type="text" styleClass="wd75px" value="{!shop.propertyConfirmationCounts[3]}" 
                                                                                        onchange="correctInputRules(this,'number','6','','','','0'); calculateShopGoalRateSum();" tabIndex=""/></td>
                                                                                    <td class=" b_none l_none"><apex:input type="text" styleClass="wd75px" value="{!shop.propertyConfirmationCounts[4]}" 
                                                                                        onchange="correctInputRules(this,'number','6','','','','0'); calculateShopGoalRateSum();" tabIndex=""/></td>
                                                                                    <td class=" b_none l_none"><apex:input type="text" styleClass="wd75px" value="{!shop.propertyConfirmationCounts[5]}" 
                                                                                        onchange="correctInputRules(this,'number','6','','','','0'); calculateShopGoalRateSum();" tabIndex=""/></td>
                                                                                    <td class=" b_none l_none"><apex:input type="text" styleClass="wd75px" value="{!shop.propertyConfirmationCounts[6]}" 
                                                                                        onchange="correctInputRules(this,'number','6','','','','0'); calculateShopGoalRateSum();" tabIndex=""/></td>
                                                                                    <td class=" b_none l_none"><apex:input type="text" styleClass="wd75px" value="{!shop.propertyConfirmationCounts[7]}" 
                                                                                        onchange="correctInputRules(this,'number','6','','','','0'); calculateShopGoalRateSum();" tabIndex=""/></td>
                                                                                    <td class=" b_none l_none"><apex:input type="text" styleClass="wd75px" value="{!shop.propertyConfirmationCounts[8]}" 
                                                                                        onchange="correctInputRules(this,'number','6','','','','0'); calculateShopGoalRateSum();" tabIndex=""/></td>
                                                                                    <td class=" b_none l_none"><apex:input type="text" styleClass="wd75px" value="{!shop.propertyConfirmationCounts[9]}" 
                                                                                        onchange="correctInputRules(this,'number','6','','','','0'); calculateShopGoalRateSum();" tabIndex=""/></td>
                                                                                    <td class=" b_none l_none"><apex:input type="text" styleClass="wd75px" value="{!shop.propertyConfirmationCounts[10]}" 
                                                                                        onchange="correctInputRules(this,'number','6','','','','0'); calculateShopGoalRateSum();" tabIndex=""/></td>
                                                                                    <td class=" b_none l_none"><apex:input type="text" styleClass="wd75px" value="{!shop.propertyConfirmationCounts[11]}" 
                                                                                        onchange="correctInputRules(this,'number','6','','','','0'); calculateShopGoalRateSum();" tabIndex=""/></td>
                                                                                    
                                                                                    
                                                                                </tr>
                                                                            </apex:repeat>
                                                                        </table>
                                                                    </div>
                                                                    <!-- /横スクロール部分 -->
                                                                </div>
                                                                
                                                            </form>
                                                        </li>
                                                    </ul>
                                        </li>
                                    </apex:outputPanel>
                                    </apex:outputPanel>
                                    </ul>
                                </div>
                            </div>
                        </apex:form>
                    </section>
                </section>
            </article>
        </main>
        
        <apex:outputPanel id="js">
        <script>
        $(function() {
            var Accordion = function(el, multiple) {
                this.el = el || {};
                this.multiple = multiple || false;
                
                // Variables privadas
                var links = this.el.find('.link');
                // Evento
                links.off('click');//重複登録を防ぐ
                links.on('click', {el: this.el, multiple: this.multiple}, this.dropdown)
                
                var btns = links.find('.ab_btn');
                btns.on('click', function(e){return false;})
            }
            
            Accordion.prototype.dropdown = function(e) {
                var eventClass = event.target.className;
                if(eventClass != "modal btn-w-2 btn-w-2_normal blue"){
                    var $el = e.data.el;
                    $this = $(this),
                        $next = $this.next();
                    
                    $next.slideToggle();
                    $this.parent().toggleClass('open');
                    
                    if (!e.data.multiple) {
                    };
                }
                
            }
            
            var accordion = new Accordion($('#accordion'), false);
        });
        
        $(function() {
            $('#btn').on('click', function(e) {
                var textList = document.getElementById('accordion');
                let elements = textList.getElementsByTagName('li');
                Array.prototype.forEach.call(elements, function(element) {
                    element.classList.remove('open','default');
                    $('.submenu-defalt').fadeOut()
                });
            });
        });
        </script>
        </apex:outputPanel>
    </body>
</apex:page>